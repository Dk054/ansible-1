# Домашнее задание к занятию 1 «Введение в Ansible»

## Подготовка к выполнению

1. Установите Ansible версии 2.10 или выше.
2. Создайте свой публичный репозиторий на GitHub с произвольным именем.
3. Скачайте [Playbook](./playbook/) из репозитория с домашним заданием и перенесите его в свой репозиторий.

## Основная часть

1. Попробуйте запустить playbook на окружении из `test.yml`, зафиксируйте значение, которое имеет факт `some_fact` для указанного хоста при выполнении playbook.
```
- TASK [Print fact] **************************************************************************************************************************************************************************************************************************************************************************************************
  ok: [localhost] => {
  "msg": 12
  }
```
2. Найдите файл с переменными (group_vars), в котором задаётся найденное в первом пункте значение, и поменяйте его на `all default fact`.
- готово
3. Воспользуйтесь подготовленным (используется `docker`) или создайте собственное окружение для проведения дальнейших испытаний. 
- добавил блок   
- > Записал открытую(public) часть своего ssh-ключа в переменную ```vms_ssh_root_key```
```vars:
  ansible_ssh_common_args: '-o StrictHostKeyChecking=no' #отключает проверку SSH-отпечатка хоста при подключении.
  hosts:
  host1:                       # Первое имя хоста
  ansible_host: 89.169.149.50
  ansible_user: ubuntu
  ansible_ssh_private_key_file: ~/.ssh/id_rsa
  host2:                       # Второе имя хоста
  ansible_host: 89.169.137.127
  ansible_user: ubuntu
  ansible_ssh_private_key_file: ~/.ssh/id_rsa
  ```
4. Проведите запуск playbook на окружении из `prod.yml`. Зафиксируйте полученные значения `some_fact` для каждого из `managed host`.
- ответ:
- ```TASK [Print fact] **************************************************************************************************************************************************************************************************************************************************************************************************
  ok: [host1] => {
  "msg": "all default fact"
  }
  ok: [host2] => {
  "msg": "all default fact"
  }TASK [Print fact] **************************************************************************************************************************************************************************************************************************************************************************************************
  ok: [host1] => {
  "msg": "all default fact"
  }
  ok: [host2] => {
  "msg": "all default fact"
  }
    ```
5. Добавьте факты в `group_vars` каждой из групп хостов так, чтобы для `some_fact` получились значения: для `deb` — `deb default fact`, для `el` — `el default fact`.
- так как для тренировки добавил группу yandex, то запускал командой **ansible-playbook -i inventory/prod.yml site.yml --limit "el,deb"**
- вывод:
```TASK [Print fact] **************************************************************************************************************************************************************************************************************************************************************************************************
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
    
   ```
6.  Повторите запуск playbook на окружении `prod.yml`. Убедитесь, что выдаются корректные значения для всех хостов.
```
TASK [Print fact] **************************************************************************************************************************************************************************************************************************************************************************************************
ok: [VM1] => {
    "msg": "all default fact"
}
ok: [VM2] => {
    "msg": "all default fact"
}
ok: [centos7] => {
    "msg": "el default fact"
}
ok: [ubuntu] => {
    "msg": "deb default fact"
}
```
7. При помощи `ansible-vault` зашифруйте факты в `group_vars/deb` и `group_vars/el` с паролем `netology`.
```
- Зашифровать файл для групп
ansible-vault encrypt group_vars/deb/examp.yml
ansible-vault encrypt group_vars/el/examp.yml
```
8. Запустите playbook на окружении `prod.yml`. При запуске `ansible` должен запросить у вас пароль. Убедитесь в работоспособности.
```
-флаг --ask-vault-pass
ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
```
9. Посмотрите при помощи `ansible-doc` список плагинов для подключения. Выберите подходящий для работы на `control node`.
```
ansible-doc -t connection -l
после изучения пришел к выводу
для группы yandex:
# Ansible автоматически использует SSH, так как указаны:
# - ansible_host (IP адрес)
# - ansible_user
# - ansible_ssh_private_key_file
 Для групп el и deb - local 
 Для новой группы   - local
```
10. В `prod.yml` добавьте новую группу хостов с именем  `local`, в ней разместите localhost с необходимым типом подключения.
11. Запустите playbook на окружении `prod.yml`. При запуске `ansible` должен запросить у вас пароль. Убедитесь, что факты `some_fact` для каждого из хостов определены из верных `group_vars`.
- ansible-playbook -i inventory/prod.yml site.yml --ask-vault-pass
``` КАРТА ВЫБОРА ДЛЯ ВСЕХ ХОСТОВ

Хост	Принадлежит группам	Ищет в директориях	        Находит файл	    Значение some_fact
VM1	        yandex, all    	1. group_vars/yandex/
                            2. group_vars/all/	     group_vars/all/examp.yml	"all default fact"
-----------------------------------------------------------------------------------------------------
VM2	         yandex, all	1. group_vars/yandex/
                            2. group_vars/all/	      group_vars/all/examp.yml	"all default fact"
-----------------------------------------------------------------------------------------------------
centos7	     el, all	    1. group_vars/el/
                            2. group_vars/all/	      group_vars/el/examp.yml	"el default fact"
-----------------------------------------------------------------------------------------------------
ubuntu	     deb, all	    1. group_vars/deb/
                            2. group_vars/all/	      group_vars/deb/examp.yml	"deb default fact"
-----------------------------------------------------------------------------------------------------
localhost	local, all	    1. group_vars/local/
                            2. group_vars/all/	      group_vars/all/examp.yml	"all default fact"
-----------------------------------------------------------------------------------------------------


```

12. Заполните `README.md` ответами на вопросы. Сделайте `git push` в ветку `master`. В ответе отправьте ссылку на ваш открытый репозиторий с изменённым `playbook` и заполненным `README.md`.
13. Предоставьте скриншоты результатов запуска команд.

## Необязательная часть

1. При помощи `ansible-vault` расшифруйте все зашифрованные файлы с переменными.
2. Зашифруйте отдельное значение `PaSSw0rd` для переменной `some_fact` паролем `netology`. Добавьте полученное значение в `group_vars/all/exmp.yml`.
3. Запустите `playbook`, убедитесь, что для нужных хостов применился новый `fact`.
4. Добавьте новую группу хостов `fedora`, самостоятельно придумайте для неё переменную. В качестве образа можно использовать [этот вариант](https://hub.docker.com/r/pycontribs/fedora).
5. Напишите скрипт на bash: автоматизируйте поднятие необходимых контейнеров, запуск ansible-playbook и остановку контейнеров.
6. Все изменения должны быть зафиксированы и отправлены в ваш личный репозиторий.

---

### Как оформить решение задания

Приложите ссылку на ваше решение в поле «Ссылка на решение» и нажмите «Отправить решение»
---
